parameters
{
    mask float(-1.0)
	color Vec4(1.0,1.0,1.0,1.0)
	diffuse_texture texture("example")
}

sub_effect
{
	/* ALL
    requirement
    {
        driver  OpenGL(4,1)
        shader  GLSL(410)
    }
    */
	
    technique "forward"
    {
        pass 
        {
            zbuffer less
            blend off
            cullface back
            lights off
            shader source 
            {
                ////////////////
                #include <Camera>
                #include <Transform>
                #include <Vertex>
                ////////////////
                struct VertexShaderOutput
                {
                    Vec4 m_position : SV_POSITION;  // interpolated vertex position (system value)
                    Vec2 m_uv       : NORMAL0;      // interpolated uv map
                };

                //global uniform
                float mask;
                Vec4 color;
				
				//texture
				Sampler2D(diffuse_texture);

                VertexShaderOutput vertex(Position3DNormalUV input) 
                {    

                    Vec4 position = Vec4(input.m_position, 1.0f);
                    position = mul(position, model_model);
                    position = mul(position, camera_view);
                    position = mul(position, camera_projection);
                    VertexShaderOutput output;
                    output.m_position = position;
                    output.m_uv = input.m_uv;

                    return output;
                }


                Vec4 fragment(VertexShaderOutput input) : SV_TARGET
                {
                  Vec4 texture_color = texture2D(diffuse_texture,input.m_uv);
                  if (texture_color.a <= mask) discard;
                  return  color * Vec4(texture_color.rgb,1.0);
                }
            }
        }
    }
}
